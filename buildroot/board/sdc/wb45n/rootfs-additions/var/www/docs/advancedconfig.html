<!--
Web Based Configuration Tool for WB40NBT/WB45NBT
Joe Conley, joe.conley@lairdtech.com
-->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Web based configuration tool for WB platform">
    <meta name="author" content="Joseph Conley:joe.conley@lairdtech.com">
    <link rel="icon" href="/assets/img/laird_logo.png">

    <!-- Le styles -->
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet">
    <link href="../assets/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="../assets/js/html5shiv.js"></script>
    <![endif]-->
<title>SCU - About</title>
  </head>

  <body>

    <div class="container">
	<br>
		<div class="row">
		<div class="hidden-xs col-sm-3 col-md-4"></div>	
		<div class="hidden-xs col-sm-4 col-md-4"><a class="brand"><img src="/assets/img/laird_logo.png"></a></div>
		<div class="hidden-xs col-sm-4 col-md-4"></div>	
		</div>
	<br>
	<nav class="navbar navbar-default " role="navigation">
		<ul class="nav nav-tabs nav-justified">
			<li><a href="/status.html">Status</a></li>
			<li><a href="/profileconfig.html">Profile Configuration</a></li>
			<li><a href="/globalconfig.html">Global Configuration</a></li>
			<li class="active"><a href="/advancedconfig.html">Advanced Configuration</a></li>
			<li><a href="/about.html">About</a></li>
		</ul>
	<div class="panel panel-default">
	<div class="row panel-body">
	<br>
	<div class="col-xs-12 col-sm-10 col-md-10 col-sm-offset-2 col-md-offset-2"><h2>Advanced Configuration</h2></div>
	<br>
	<br>
	<br>
	<br>
		<form name="PasswordChange" class="form-horizontal col-md-offset-2" role="form" action='' method='post'>
		  <div class="form-group">
			<label for="inputCurrentPass" class="col-md-3 control-label">Current Admin Password:</label>
			<div class="col-md-5">
			<?php 
			  echo "<input type='password' name='CurrentPass' class='form-control input-sm' id='inputCurrentPass' value='$getCurrentPass'>";
			?>
			</div>
		  </div>
		  <div class="form-group">
			<label for="inputPassword1" class="col-md-3 control-label">New Admin Password:</label>
			<div class="col-md-5">
			<?php
			  echo "<input type='password' name='NewPass' class='form-control input-sm' id='inputPassword1' value='$getNewPass'>";
			?>
			</div>
		  </div>
		  <div class="form-group">
			<label for="inputPassword2" class="col-md-3 control-label">Confirm Admin Password:</label>
			<div class="col-md-5">
			<?php
			  echo "<input type='password' name='NewPass2' class='form-control input-sm' id='inputPassword2' value='$getNewPass2'>";
			?>
			</div>
		  </div>
		  <div class="form-group">
			<div class="col-md-offset-3 col-md-8">
			  <button type="submit" class="btn btn-primary">Submit Password Change</button>
			  <input type = "hidden" name = "PasswordChange" value = "<?php echo $_POST['PasswordChange']; ?>"/>
			</div>
		  </div>
		</form>
		<br>
		<br>
		<form name="RemoteUpdate" class="form-horizontal col-md-offset-2" role="form" action='' method='post'>
		  <div class="form-group">
			<label for="RemotePath1" class="col-md-3 control-label">Remote Directory Path</label>
			<div class="col-md-5">
				<?php
				  echo "<input type='text' name='RemotePath' class='form-control input-sm' id='RemotePath1' placeholder='//<server/path/to/images>/fw.txt' value='$getRemotePath'>";
				?>	
			</div>
				<div class="col-md-offset-3 col-md-3 ">
					  <label class="radio radio-inline">
						<?php
						  echo "<input type='radio' name='optionsRadios' id='optionsRadios1' value='http:' checked>";
						?>	
						HTTP
					  </label>
					  <label class="radio radio-inline">
						<?php
						  echo "<input type='radio' name='optionsRadios' id='optionsRadios2' value='ftp:'>";
						?>	
						FTP
					  </label>
				</div>
			  </div>
		  <div class="form-group">
			<div class="col-md-offset-3 col-md-8">
			  <button type="submit" class="btn btn-primary">Start Remote Update</button>
  			  <input type = "hidden" name = "RemoteUpdate" value = "<?php echo $_POST['RemoteUpdate']; ?>"/>
			</div>
		  </div>
		</form>
	</div><!-- /row panel-body  -->
	
		<?php
	if (isset($_POST['PasswordChange']))
		{
			$PasswordChange=$_POST["PasswordChange"];
			$CurrentPass=$_POST["CurrentPass"];
			$NewPass=$_POST["NewPass"];
			$NewPass2=$_POST["NewPass2"];
			
			$RealPasswordFile='/etc/lighttpd/lighttpd.password';
			$RealCurrentUser=exec("awk -F ':' '{ print $1 }' /etc/lighttpd/lighttpd.password");
			$RealCurrentPass=exec("awk -F ':' '{ print $2 }' /etc/lighttpd/lighttpd.password");
			if ($RealCurrentPass == $CurrentPass)
			{
				if ($NewPass == $NewPass2)
				{
					if (strlen($NewPass) > 0 && strlen($NewPass2) > 0)
					{
						if (file_exists($RealPasswordFile))
						{	
							$fp = fopen($RealPasswordFile, 'w');
							fwrite($fp, $RealCurrentUser . ":" . $NewPass2 . "\n");
							fclose($fp);						
						}
						else 
						{
							exec('touch /etc/lighttpd/lighttpd.password');
							$fp = fopen($RealPasswordFile, 'w');
							fwrite($fp, $RealCurrentUser . ":" . $NewPass2 . "\n");
							fclose($fp);	
						}	
					}
					else
					{
						?>
						<script>
						alert("New Passwords must not be blank!");
						</script>
						<?php					
					}
				}
				else
				{
					?>
					<script>
					alert("New passwords do not match!");
					</script>
					<?php
				}
			}
			elseif (strlen($CurrentPass) > 0)
			{
				?>
				<script>
				alert("Current password is incorrect");
				</script>
				<?php
			}
			
			echo "<form id=refresh action='' method = 'post'>";
			echo "</form>";
			// echo "<script>document.getElementById('refresh').submit();</script>";
		}
		if (isset($_POST['RemoteUpdate']))
		{
			$RemoteUpdate=$_POST["RemoteUpdate"];
			$RemotePath=$_POST["RemotePath"];
			$optionsRadios=$_POST["optionsRadios"];
			
			if (strlen($RemotePath) > 0)
			{
				echo "Future feature, does not work yet.";
				echo "<br>";
				echo "Path entered: " . $optionsRadios . $RemotePath;
			}
			
			echo "<form id=refresh action='' method = 'post'>";
			echo "</form>";
		}
		?>
	</div><!-- /pannel panel-default  -->
	</nav>
    </div> <!-- /container -->

    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="../assets/js/bootstrap.min.js"></script>


  </body>
</html>
