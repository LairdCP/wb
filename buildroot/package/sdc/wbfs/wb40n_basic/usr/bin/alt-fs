#!/bin/sh
# Software Data Transfer Utility for Laird Technologies, Inc's WB40NBT device
# Eric Bentley, ebentley@summitdata.com
# June 21, 2012

MOUNT_POINT=/mnt/other_rootfs

mount_fs() {	
        ubiattach -p /dev/`target_rootfs` 
        mkdir -p $MOUNT_POINT 
        mount -t ubifs /dev/ubi1_0 $MOUNT_POINT
}

dismount_fs() {
        umount $MOUNT_POINT
        rmdir $MOUNT_POINT
        ubidetach -p /dev/`target_rootfs` 
}

current_rootfs()
{
	echo mtd`awk {printf'$3'} /proc/cmdline  | cut -d= -f2`
}

target_rootfs()
{
	if [ `current_rootfs` == mtd6 ]
	then 
		echo mtd5
	else
		echo mtd6
	fi
}

uname -m | grep ^arm > /dev/null
if [ $? != 0 ]
then
        echo "This script is for embedded Linux only."
        exit
fi

case $1 in
mount)
	mount_fs
;;
dismount)
	dismount_fs
;;
*)
	echo This script will allow you to mount or dismount the non-current rootfs
	echo
	echo usage: $0 "mount | dismount"
	exit
;;
esac

echo transfer_complete



